var Keycloak=function(e){function r(){return m.authServerUrl+"/realms/"+encodeURIComponent(m.realm)}function t(e,t){var n=e.code,o=e.error,s=e.prompt;if(n){var c="code="+n,i=r()+"/tokens/access/codes",l=new XMLHttpRequest;l.open("POST",i,!0),l.setRequestHeader("Content-type","application/x-www-form-urlencoded"),m.clientId&&m.clientSecret?l.setRequestHeader("Authorization","Basic "+btoa(m.clientId+":"+m.clientSecret)):c+="&client_id="+encodeURIComponent(m.clientId),l.withCredentials=!0,l.onreadystatechange=function(){if(4==l.readyState)if(200==l.status){var e=JSON.parse(l.responseText);a(e.access_token,e.refresh_token),m.onAuthSuccess&&m.onAuthSuccess(),t&&t.setSuccess()}else m.onAuthError&&m.onAuthError(),t&&t.setError()},l.send(c)}else o&&("none"!=s?(m.onAuthError&&m.onAuthError(),t&&t.setError()):t&&t.setSuccess())}function n(){var r,t=l();if(e?"string"==typeof e&&(r=e):r="keycloak.json",r){var n=new XMLHttpRequest;n.open("GET",r,!0),n.setRequestHeader("Accept","application/json"),n.onreadystatechange=function(){if(4==n.readyState)if(200==n.status){var e=JSON.parse(n.responseText);m.authServerUrl=e["auth-server-url"],m.realm=e.realm,m.clientId=e.resource,m.clientSecret=(e.credentials||{}).secret,t.setSuccess()}else t.setError()},n.send()}else{if(!e.url)for(var o=document.getElementsByTagName("script"),a=0;a<o.length;a++)if(o[a].src.match(/.*keycloak\.js/)){e.url=o[a].src.substr(0,o[a].src.indexOf("/js/keycloak.js"));break}if(!e.realm)throw"realm missing";if(!e.clientId)throw"clientId missing";m.authServerUrl=e.url,m.realm=e.realm,m.clientId=e.clientId,m.clientSecret=(e.credentials||{}).secret,t.setSuccess()}return t.promise}function o(){m.token&&(a(null,null),m.onAuthLogout&&m.onAuthLogout(),m.loginRequired&&m.login())}function a(e,r){if((e||r)&&u(),e){m.token=e,m.tokenParsed=JSON.parse(decodeURIComponent(escape(window.atob(e.split(".")[1]))));var t=m.realm+"-"+m.tokenParsed.sub;m.tokenParsed.session_state&&(t=t+"-"+m.tokenParsed.session_state),m.sessionId=t,m.authenticated=!0,m.subject=m.tokenParsed.sub,m.realmAccess=m.tokenParsed.realm_access,m.resourceAccess=m.tokenParsed.resource_access;for(var n=0;n<k.length;n++){var o=k[n];m.tokenParsed[o]&&(m.idToken||(m.idToken={}),m.idToken[o]=m.tokenParsed[o])}}else delete m.token,delete m.tokenParsed,delete m.subject,delete m.realmAccess,delete m.resourceAccess,delete m.idToken,m.authenticated=!1;r?(m.refreshToken=r,m.refreshTokenParsed=JSON.parse(atob(r.split(".")[1]))):(delete m.refreshToken,delete m.refreshTokenParsed)}function s(){for(var e=[],r="0123456789abcdef",t=0;36>t;t++)e[t]=r.substr(Math.floor(16*Math.random()),1);e[14]="4",e[19]=r.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-";var n=e.join("");return n}function c(){var e="<id: "+m.callback_id++ +Math.random()+">";return e}function i(e){if(-1!=e.indexOf("?")){for(var r={},t=e.split("?")[1].split("&"),n=0;n<t.length;n++){var o=t[n].split("=");switch(decodeURIComponent(o[0])){case"code":r.code=o[1];break;case"error":r.error=o[1];break;case"state":r.state=decodeURIComponent(o[1]);break;case"redirect_fragment":r.fragment=decodeURIComponent(o[1]);break;case"prompt":r.prompt=o[1]}}if((r.code||r.error)&&r.state&&r.state==sessionStorage.oauthState)return delete sessionStorage.oauthState,r}}function l(){var e={setSuccess:function(r){e.success=!0,e.result=r,e.successCallback&&e.successCallback(r)},setError:function(r){e.error=!0,e.result=r,e.errorCallback&&e.errorCallback(r)},promise:{success:function(r){return e.success?r(e.result):e.error||(e.successCallback=r),e.promise},error:function(r){return e.error?r(e.result):e.success||(e.errorCallback=r),e.promise}}};return e}function u(){if(h.enable&&!h.iframe){var e=document.createElement("iframe");e.onload=function(){var t=r();h.iframeOrigin="/"===t.charAt(0)?window.location.origin:t.substring(0,t.indexOf("/",8)),h.iframe=e};var t=r()+"/login-status-iframe.html?client_id="+encodeURIComponent(m.clientId)+"&origin="+window.location.origin;e.setAttribute("src",t),e.style.display="none",document.body.appendChild(e);var n=function(e){if(e.origin===h.iframeOrigin){var r=e.data,t=h.callbackMap[r.callbackId];delete h.callbackMap[r.callbackId],m.sessionId==r.session&&r.loggedIn?t.setSuccess():(o(),t.setError())}};window.addEventListener("message",n,!1);var a=function(){d(),m.token&&setTimeout(a,1e3*h.interval)};setTimeout(a,1e3*h.interval)}}function d(){var e=l();if(h.iframe||h.iframeOrigin){var r={};r.callbackId=c(),h.callbackMap[r.callbackId]=e;var t=h.iframeOrigin;h.iframe.contentWindow.postMessage(r,t)}else e.setSuccess();return e.promise}function f(e){if(!e||"default"==e)return{login:function(e){window.location.href=m.createLoginUrl(e)},logout:function(e){window.location.href=m.createLogoutUrl(e)},accountManagement:function(){window.location.href=m.createAccountUrl()},redirectUri:function(e){if(e&&e.redirectUri)return e.redirectUri;if(m.redirectUri)return m.redirectUri;var r=location.protocol+"//"+location.hostname+(location.port&&":"+location.port)+location.pathname;return location.hash&&(r+="?redirect_fragment="+encodeURIComponent(location.hash.substring(1))),r}};if("cordova"==e)return h.enable=!1,{login:function(e){var r=l(),n="location=no";e&&"none"==e.prompt&&(n+=",hidden=yes");var o,a,s=m.createLoginUrl(e),c=window.open(s,"_blank",n);return c.addEventListener("loadstart",function(e){0==e.url.indexOf("http://localhost")&&(o=i(e.url),c.close())}),c.addEventListener("loaderror",function(e){0!=e.url.indexOf("http://localhost")&&(a=!0,c.close())}),c.addEventListener("exit",function(){a||!o?r.setError():t(o,r)}),r.promise},logout:function(e){var r,t=l(),n=m.createLogoutUrl(e),a=window.open(n,"_blank","location=no,hidden=yes");return a.addEventListener("loadstart",function(e){0==e.url.indexOf("http://localhost")&&a.close()}),a.addEventListener("loaderror",function(e){0!=e.url.indexOf("http://localhost")&&(r=!0,a.close())}),a.addEventListener("exit",function(){r?t.setError():(o(),t.setSuccess())}),t.promise},accountManagement:function(){var e=m.createAccountUrl(),r=window.open(e,"_blank","location=no");r.addEventListener("loadstart",function(e){0==e.url.indexOf("http://localhost")&&r.close()})},redirectUri:function(){return"http://localhost"}};throw"invalid adapter type: "+e}if(!(this instanceof Keycloak))return new Keycloak(e);var p,m=this,h={enable:!0,callbackMap:[],interval:5};m.init=function(r){function o(){var e=i(window.location.href);if(e)return window.history.replaceState({},null,location.protocol+"//"+location.host+location.pathname+(e.fragment?"#"+e.fragment:"")),void t(e,c);if(r){if(r.token||r.refreshToken)a(r.token,r.refreshToken),c.setSuccess();else if(r.onLoad){var n={};switch(r.onLoad){case"check-sso":n.prompt="none";case"login-required":var o=m.login(n);o&&o.success(function(){c.setSuccess()}).error(function(){c.setError()});break;default:throw"Invalid value for onLoad"}}}else c.setSuccess()}m.authenticated=!1,p=window.Cordova?f("cordova"):f(),r&&("undefined"!=typeof r.checkLoginIframe&&(h.enable=r.checkLoginIframe),r.checkLoginIframeInterval&&(h.interval=r.checkLoginIframeInterval),"login-required"===r.onLoad&&(m.loginRequired=!0));var s=l(),c=l();c.promise.success(function(){m.onReady&&m.onReady(m.authenticated),s.setSuccess(m.authenticated)}).error(function(){s.setError()});var u=n(e);return u.success(o),u.error(function(){s.setError()}),s.promise},m.login=function(e){return p.login(e)},m.createLoginUrl=function(e){var t=s(),n=p.redirectUri(e);e&&e.prompt&&(n+=-1==n.indexOf("?")?"?prompt="+e.prompt:"&prompt="+e.prompt),sessionStorage.oauthState=t;var o=r()+"/tokens/login?client_id="+encodeURIComponent(m.clientId)+"&redirect_uri="+encodeURIComponent(n)+"&state="+encodeURIComponent(t)+"&response_type=code";return e&&e.prompt&&(o+="&prompt="+e.prompt),o},m.logout=function(e){return p.logout(e)},m.createLogoutUrl=function(e){var t=r()+"/tokens/logout?redirect_uri="+encodeURIComponent(p.redirectUri(e));return t},m.createAccountUrl=function(e){var t=r()+"/account?referrer="+encodeURIComponent(m.clientId)+"&referrer_uri="+encodeURIComponent(p.redirectUri(e));return t},m.accountManagement=function(){return p.accountManagement()},m.hasRealmRole=function(e){var r=m.realmAccess;return!!r&&r.roles.indexOf(e)>=0},m.hasResourceRole=function(e,r){if(!m.resourceAccess)return!1;var t=m.resourceAccess[r||m.clientId];return!!t&&t.roles.indexOf(e)>=0},m.loadUserProfile=function(){var e=r()+"/account",t=new XMLHttpRequest;t.open("GET",e,!0),t.setRequestHeader("Accept","application/json"),t.setRequestHeader("Authorization","bearer "+m.token);var n=l();return t.onreadystatechange=function(){4==t.readyState&&(200==t.status?(m.profile=JSON.parse(t.responseText),n.setSuccess(m.profile)):n.setError())},t.send(),n.promise},m.isTokenExpired=function(e){if(!m.tokenParsed||!m.refreshToken)throw"Not authenticated";var r=m.tokenParsed.exp-(new Date).getTime()/1e3;return e&&(r-=e),0>r},m.updateToken=function(e){var t=l();if(!m.tokenParsed||!m.refreshToken)return t.setError(),t.promise;e=e||5;var n=function(){if(m.isTokenExpired(e)){var n="grant_type=refresh_token&refresh_token="+m.refreshToken,o=r()+"/tokens/refresh",s=new XMLHttpRequest;s.open("POST",o,!0),s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),m.clientId&&m.clientSecret?s.setRequestHeader("Authorization","Basic "+btoa(m.clientId+":"+m.clientSecret)):n+="&client_id="+encodeURIComponent(m.clientId),s.onreadystatechange=function(){if(4==s.readyState)if(200==s.status){var e=JSON.parse(s.responseText);a(e.access_token,e.refresh_token),m.onAuthRefreshSuccess&&m.onAuthRefreshSuccess(),t.setSuccess(!0)}else m.onAuthRefreshError&&m.onAuthRefreshError(),t.setError()},s.send(n)}else t.setSuccess(!1)};if(h.enable){var o=d();o.success(function(){n()}).error(function(){t.setError()})}else n();return t.promise},m.callback_id=0;var k=["name","given_name","family_name","middle_name","nickname","preferred_username","profile","picture","website","email","email_verified","gender","birthdate","zoneinfo","locale","phone_number","phone_number_verified","address","updated_at","formatted","street_address","locality","region","postal_code","country","claims_locales"]};
//# sourceMappingURL=keycloak.min.js.map